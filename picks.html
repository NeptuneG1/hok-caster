<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Honor of Kings — Draft (10 Skill Columns)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #1c1f26;
      --panel: #1f1f1f;
      --panel-2: #2a2a2a;
      --border: #444;
      --accent: #ff7733;
      --muted: #9da3ae;
      --text: #f0f0f0;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', system-ui, -apple-system, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }
    header {
      padding: 16px 20px;
      border-bottom: 2px solid var(--accent);
      background: linear-gradient(to right, #0f0f14, #1a1b23);
    }
    header h1 {
      margin: 0;
      font-size: 20px;
      color: var(--accent);
      letter-spacing: 0.5px;
    }
    .container {
      padding: 20px;
      max-width: 1300px;
      margin: 0 auto;
    }

    /* Draft picks (no bans) */
    .draft-wrapper {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 24px;
      margin-bottom: 24px;
    }
    .team-column {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
    }
    .team-title {
      font-weight: 700;
      margin: 0 0 12px 0;
      color: #e5e5e5;
      letter-spacing: 0.4px;
    }
    .hero-section {
      display: grid;
      grid-template-columns: repeat(5, minmax(90px, 1fr));
      gap: 10px;
    }
    .hero-card {
      background: #1e1e1e;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 8px;
      text-align: center;
    }
    .hero-image {
      width: 100%;
      height: auto;
      border-radius: 6px;
      cursor: pointer;
      aspect-ratio: 1 / 1;
      object-fit: cover;
    }
    .hero-name {
      margin-top: 6px;
      font-size: 12px;
      color: #e5e5e5;
      min-height: 16px;
    }

    /* Skills board: 10 fixed columns */
    .board-wrap {
      overflow-x: auto;
      background: var(--panel-2);
      border: 1px solid var(--border);
      border-radius: 12px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 1200px; /* ensure room for 10 columns */
    }
    thead th {
      background: #1f1f1f;
      border-bottom: 1px solid var(--border);
      padding: 10px;
      text-align: left;
      font-size: 13px;
    }
    tbody td {
      border-top: 1px solid var(--border);
      padding: 10px;
      vertical-align: top;
    }
    .col-head {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 700;
      color: #e5e5e5;
    }
    .slot-tag {
      font-size: 11px;
      font-weight: 600;
      padding: 2px 6px;
      border: 1px solid var(--accent);
      border-radius: 999px;
      color: var(--accent);
      white-space: nowrap;
    }
    .cell-hero {
      margin-top: 6px;
      font-weight: 700;
    }
    .muted { color: var(--muted); }

    .skill {
      display: flex;
      gap: 10px;
      align-items: flex-start;
      margin: 8px 0;
      line-height: 1.3;
    }
    .skill img {
      width: 28px;
      height: 28px;
      border-radius: 4px;
      flex-shrink: 0;
    }
    .skill em {
      font-style: normal;
      color: #ffcd91;
      font-size: 12px;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 9999;
      inset: 0;
      background: rgba(0,0,0,0.8);
      overflow: auto;
      padding: 40px 16px;
    }
    .modal-content {
      background: var(--panel);
      border: 2px solid var(--accent);
      border-radius: 12px;
      max-width: 980px;
      margin: 0 auto;
      padding: 16px;
      max-height: 85vh;
      overflow: auto;
    }
    .modal-header {
      display: flex;
      align-items: center;
      gap: 10px;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    .modal-title {
      font-weight: 700;
      font-size: 16px;
      color: var(--accent);
    }
    .modal-actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .btn {
      background: transparent;
      border: 1px solid var(--accent);
      color: var(--accent);
      padding: 6px 10px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
    }
    .filters {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }
    .filters select, .filters input {
      background: #2b2b2b;
      color: #fff;
      border: 1px solid #666;
      border-radius: 6px;
      padding: 6px 8px;
      font-size: 13px;
      min-width: 160px;
    }
    .hero-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(88px, 1fr));
      gap: 10px;
    }
    .hero-grid-item {
      position: relative;
      text-align: center;
      font-size: 11px;
      background: #232323;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 6px;
    }
    .hero-grid-item img {
      width: 100%;
      border-radius: 6px;
      cursor: pointer;
      aspect-ratio: 1 / 1;
      object-fit: cover;
    }
    .hero-grid-item .hname {
      margin-top: 6px;
      color: #e5e5e5;
      min-height: 16px;
    }
    .disabled {
      pointer-events: none;
      opacity: 0.35;
      filter: grayscale(0.2);
    }
    .used-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255,0,0,0.35);
      color: #fff;
      font-weight: 700;
      border-radius: 8px;
      font-size: 11px;
      letter-spacing: 0.7px;
    }

    @media (max-width: 900px) {
      .hero-section { grid-template-columns: repeat(5, minmax(70px, 1fr)); }
    }
    @media (max-width: 640px) {
      .hero-section { grid-template-columns: repeat(5, minmax(56px, 1fr)); }
      .team-title { font-size: 13px; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Honor of Kings — Draft (10 Skill Columns)</h1>
  </header>

  <div class="container">
    <!-- Picks (5 per team) -->
    <div class="draft-wrapper">
      <section class="team-column">
        <h2 class="team-title">Team 1</h2>
        <div class="hero-section" id="team1"></div>
      </section>

      <section class="team-column">
        <h2 class="team-title">Team 2</h2>
        <div class="hero-section" id="team2"></div>
      </section>
    </div>

    <!-- Fixed 10-column skills board -->
    <div class="board-wrap">
      <table>
        <thead>
          <tr id="boardHead"></tr>
        </thead>
        <tbody>
          <tr id="boardRow"></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal" id="heroModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title" id="modalTitle">Select a Hero</div>
        <div class="modal-actions">
          <button class="btn" id="clearBtn">Clear Slot</button>
          <button class="btn" id="closeBtn">Close</button>
        </div>
      </div>
      <div class="filters">
        <select id="laneFilter">
          <option value="">All Lanes</option>
        </select>
        <select id="roleFilter">
          <option value="">All Roles</option>
        </select>
        <input id="searchInput" placeholder="Search hero..." />
      </div>
      <div class="hero-grid" id="heroGrid"></div>
    </div>
  </div>

  <script>
    const API_URL = "https://raw.githubusercontent.com/NeptuneG1/hok-caster/main/data.json";

    let heroData = [];
    let currentSlot = null;

    // ----- Boot -----
    (async function init() {
      await loadHeroes();
      renderDraft();
      populateFilterOptions();
      bindModalButtons();
      buildBoardHeader();   // fixed 10 columns
      updateBoard();        // initial state
    })();

    async function loadHeroes() {
      const res = await fetch(API_URL);
      heroData = await res.json();
    }

    // ----- Draft UI (5 picks per team) -----
    function renderDraft() {
      const t1 = document.getElementById('team1');
      const t2 = document.getElementById('team2');
      for (let i = 0; i < 5; i++) {
        t1.appendChild(createPickSlot('team1', i));
        t2.appendChild(createPickSlot('team2', i));
      }
    }

    function createPickSlot(teamId, index) {
      const slot = document.createElement('div');
      slot.className = 'hero-card';

      const img = document.createElement('img');
      img.src = 'https://i.imgur.com/kkUX3a3.jpeg';
      img.alt = 'Empty';
      img.className = 'hero-image';
      img.dataset.hero = '';
      img.dataset.team = teamId;
      img.dataset.index = index;
      img.addEventListener('click', () => { currentSlot = img; openModal(); });

      const name = document.createElement('div');
      name.className = 'hero-name';
      name.textContent = '';

      slot.appendChild(img);
      slot.appendChild(name);
      return slot;
    }

    // ----- Modal logic -----
    function bindModalButtons() {
      document.getElementById('closeBtn').addEventListener('click', closeModal);
      document.getElementById('clearBtn').addEventListener('click', clearCurrentSlot);
      document.getElementById('laneFilter').addEventListener('change', populateModal);
      document.getElementById('roleFilter').addEventListener('change', populateModal);
      document.getElementById('searchInput').addEventListener('input', populateModal);
    }

    function openModal() {
      document.getElementById("heroModal").style.display = "block";
      populateModal();
    }
    function closeModal() {
      document.getElementById("heroModal").style.display = "none";
      currentSlot = null;
    }
    function clearCurrentSlot() {
      if (!currentSlot) return;
      const card = currentSlot.closest('.hero-card');
      currentSlot.src = 'https://i.imgur.com/kkUX3a3.jpeg';
      currentSlot.alt = 'Empty';
      currentSlot.dataset.hero = '';
      card.querySelector('.hero-name').textContent = '';
      closeModal();
      updateBoard();
    }

    function populateFilterOptions() {
      const lanes = new Set(), roles = new Set();
      heroData.forEach(h => {
        if (h.Lane) lanes.add(h.Lane);
        if (h.PrimaryRole) roles.add(h.PrimaryRole);
      });
      const laneSelect = document.getElementById('laneFilter');
      const roleSelect = document.getElementById('roleFilter');
      lanes.forEach(l => laneSelect.innerHTML += `<option value="${escapeHtml(l)}">${escapeHtml(l)}</option>`);
      roles.forEach(r => roleSelect.innerHTML += `<option value="${escapeHtml(r)}">${escapeHtml(r)}</option>`);
    }

    function populateModal() {
      const lane = document.getElementById('laneFilter').value.trim();
      const role = document.getElementById('roleFilter').value.trim();
      const q = document.getElementById('searchInput').value.trim().toLowerCase();

      const used = Array.from(document.querySelectorAll('.hero-image'))
        .map(i => i.dataset.hero).filter(Boolean);

      const grid = document.getElementById('heroGrid');
      grid.innerHTML = '';

      for (const hero of heroData) {
        if (lane && hero.Lane !== lane) continue;
        if (role && hero.PrimaryRole !== role) continue;
        if (q && !String(hero.Hero || '').toLowerCase().includes(q)) continue;

        const item = document.createElement('div');
        item.className = 'hero-grid-item';

        const img = document.createElement('img');
        img.src = hero.ImageURL;
        img.alt = hero.Hero;

        const name = document.createElement('div');
        name.className = 'hname';
        name.textContent = hero.Hero;

        const isUsed = used.includes(hero.Hero);
        if (isUsed) {
          img.classList.add('disabled');
          const overlay = document.createElement('div');
          overlay.className = 'used-overlay';
          overlay.textContent = 'USED';
          item.appendChild(overlay);
        } else {
          img.addEventListener('click', () => selectHero(hero));
        }

        item.appendChild(img);
        item.appendChild(name);
        grid.appendChild(item);
      }
    }

    function selectHero(hero) {
      if (!currentSlot) return;
      const card = currentSlot.closest('.hero-card');
      currentSlot.src = hero.ImageURL;
      currentSlot.alt = hero.Hero;
      currentSlot.dataset.hero = hero.Hero;
      card.querySelector('.hero-name').textContent = hero.Hero;
      closeModal();
      updateBoard();
    }

    // ----- Skills rendering (10 columns fixed order) -----
    function buildBoardHeader() {
      const headRow = document.getElementById('boardHead');
      headRow.innerHTML = '';

      // Columns: Team1 P1..P5, Team2 P1..P5
      const labels = [
        'T1-P1','T1-P2','T1-P3','T1-P4','T1-P5',
        'T2-P1','T2-P2','T2-P3','T2-P4','T2-P5'
      ];

      for (const tag of labels) {
        const th = document.createElement('th');
        th.innerHTML = `<div class="col-head"><span class="slot-tag">${tag}</span></div>`;
        headRow.appendChild(th);
      }
    }

    function renderSkills(hero) {
      let html = '';
      for (let i = 1; i <= 5; i++) {
        const name = hero[`SkillName${i}`];
        const desc = hero[`SkillDesc${i}`];
        const icon = hero[`SkillURL${i}`] || 'https://i.imgur.com/default-skill.png';
        const type = hero[`SkillType${i}`] || 'Unknown';
        if (name) {
          html += `
            <div class="skill">
              <img src="${escapeAttr(icon)}" alt="${escapeAttr(name)}" />
              <span>
                <div><strong>${escapeHtml(name)}</strong></div>
                <div><em>${escapeHtml(type)}</em></div>
                <div>${desc ? escapeHtml(desc).replace(/\n/g, '<br>') : 'No description'}</div>
              </span>
            </div>
          `;
        }
      }
      return html || `<div class="muted">No skills available.</div>`;
    }

    function updateBoard() {
      const row = document.getElementById('boardRow');
      row.innerHTML = '';

      const heroMap = Object.fromEntries(heroData.map(h => [h.Hero, h]));

      const picksOrder = [
        ...Array.from(document.querySelectorAll('#team1 .hero-image')).map(img => img.dataset.hero || ''),
        ...Array.from(document.querySelectorAll('#team2 .hero-image')).map(img => img.dataset.hero || '')
      ];

      for (let c = 0; c < 10; c++) {
        const td = document.createElement('td');
        const heroName = picksOrder[c];
        const hero = heroMap[heroName];

        if (hero) {
          td.innerHTML = `
            <div class="cell-hero">${escapeHtml(hero.Hero)}</div>
            ${renderSkills(hero)}
          `;
        } else {
          td.innerHTML = `<div class="muted">Empty slot</div>`;
        }

        row.appendChild(td);
      }
    }

    // Polling to keep board synced in case of quick changes
    setInterval(updateBoard, 900);

    // ----- Helpers -----
    function escapeHtml(str) {
      return String(str ?? '')
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#39;');
    }
    function escapeAttr(str) { return escapeHtml(str); }
  </script>
</body>
</html>
